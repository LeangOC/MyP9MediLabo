<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>D√©tails patient</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>
<body>

<div class="container mt-4">

    <a class="btn btn-secondary mb-3" th:href="@{/patient}">
        ‚¨Ö Retour √† la liste
    </a>

    <h2>D√©tails du patient</h2>

    <ul class="list-group mb-4">
        <li class="list-group-item"><b>Nom :</b> <span th:text="${patient.lastname}"></span></li>
        <li class="list-group-item"><b>Pr√©nom :</b> <span th:text="${patient.firstname}"></span></li>
        <li class="list-group-item">
            <b>Date de naissance :</b>
            <span th:text="${#dates.format(patient.birthdate, 'dd/MM/yyyy')}"></span>
        </li>
        <li class="list-group-item"><b>Genre :</b> <span th:text="${patient.gender}"></span></li>
    </ul>

    <!-- ü©∫ RISQUE -->
    <h3>√âvaluation du risque diab√©tique</h3>

    <div th:if="${risk != null}"
         class="alert"
         th:classappend="${risk.riskLevel == 'NONE' ? ' alert-success' :
                          risk.riskLevel == 'BORDERLINE' ? ' alert-warning' :
                          risk.riskLevel == 'IN_DANGER' ? ' alert-danger' :
                          ' alert-dark'}">

        <strong>Niveau de risque :</strong>
        <span th:text="${risk.riskLevel}"></span>
    </div>

    <div th:if="${risk == null}" class="alert alert-secondary">
        Risque non disponible
    </div>

    <!-- üìù NOTES -->
    <h3 class="mt-4">Historique des notes</h3>

    <div th:if="${notes.isEmpty()}">
        <p>Aucune note pour ce patient.</p>
    </div>

    <div th:each="note : ${notes}" class="card mb-2">
        <div class="card-body">
            <p th:text="${note.note}"></p>
            <small class="text-muted"
                   th:text="${#temporals.format(note.createdAt, 'dd/MM/yyyy HH:mm')}">
            </small>
        </div>
    </div>

    <!-- ‚ûï AJOUT -->
    <h4 class="mt-4">Ajouter une note</h4>

    <form th:action="@{/notes/add}" method="post">
        <textarea name="note" class="form-control" rows="4" required></textarea>

        <input type="hidden" name="patientId" th:value="${patient.id}">
        <input type="hidden" name="patientLastName" th:value="${patient.lastname}">

        <button class="btn btn-primary mt-2">Ajouter</button>
    </form>

</div>

</body>
</html>
